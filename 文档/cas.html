<div id="readme" style="width:70%;margin-left:25%;">
      <article class="markdown-body">
    
 
 
  <h2 id="1"><a href="#1-构建一个安全的具备单点登录功能的分布式架构springsecurity-cas" name="1-构建一个安全的具备单点登录功能的分布式架构springsecurity-cas">1 构建一个安全的具备单点登录功能的分布式架构SpringSecurity+CAS</a></h2> 
  <h2 id="101"><a href="#2-课程引导语" name="2-课程引导语">2 课程引导语</a></h2> 
  <p>互联网已经成为了我们生活一部分，但是安全问题频发，身份认证变得更为复杂。如何让这一部分更安全？如何让这一部分的身份验证变得更简单？</p> 
  <p>那么在此次课程中，大家会学习到一个全新的安全框架，通过他来做安全控制，同时使用CAS实现用户单点登录功能。</p> 
  <h2 id="102"><a href="#3-课程介绍" name="3-课程介绍">3 课程介绍</a></h2> 
  <p>本课程介绍了Spring全家桶中的安全框架SpringSecurity快速入门及使用，介绍CAS的原理，CAS单点登录快速入门，SpringSecurity整合CAS，实现用户安全校验同时实现单点登录。</p> 
  <h2 id="103"><a href="#4-课程知识点与大纲" name="4-课程知识点与大纲">4 课程知识点与大纲</a></h2> 
  <ul> 
   <li>SpringSecurity CAS</li> 
   <li>SpringSecurity 介绍</li> 
   <li>SpringSecurity入门</li> 
   <li>CAS介绍</li> 
   <li>CAS实现单点登录</li> 
   <li>SpringSecurity+CAS集成实现单点登录</li> 
  </ul> 
  <h2 id="104"><a href="#5-springsecurity" name="5-springsecurity">5 SpringSecurity</a></h2> 
  <h3 id="10401">5.1 Spring Security介绍</h3> 
  <blockquote> 
   <p>是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。</p> 
  </blockquote> 
  <h3 id="10402">5.2 SpringSecurity入门</h3> 
  <p>我们首先搭建一个web工程，然后引入spring和springsecurity相关依赖，然后基于它做一个入门案例。</p> 
  <h4 id="1160201">5.2.1 创建一个maven工程(war包)</h4> 
  <h5 id="164040101">5.2.1.1 导入pom依赖</h5> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--Spring和SpringSecurity依赖--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!--springmvc--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- spring --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-jms<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-aop<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-context-support<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.3.12.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>aspectjrt<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.8.6<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.8.6<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--SpringSecurity相关依赖--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-security-web<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.2.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-security-config<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.2.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-security-cas<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.2.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySql --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>5.1.45<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--数据连接池--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.13<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>
</code></pre> 
  <h5 id="164040102">5.2.1.2 web.xml配置</h5> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</code><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">web-app</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://java.sun.com/xml/ns/javaee"</span>
         <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span>
         <span class="hljs-attribute">id</span>=<span class="hljs-value">"WebApp_ID"</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"3.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">display-name</span>&gt;</span>springsecurity-demo<span class="hljs-tag">&lt;/<span class="hljs-title">display-name</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 编码过滤器 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>characterEncoding<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>forceEncoding<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>characterEncoding<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span>
  <span class="hljs-comment">&lt;!--//End 编码过滤器 --&gt;</span>
  <span class="hljs-comment">&lt;!-- SpringMVC --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">servlet</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-title">servlet-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-title">servlet-class</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">load-on-startup</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">servlet</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">servlet-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">servlet-name</span>&gt;</span>springmvc<span class="hljs-tag">&lt;/<span class="hljs-title">servlet-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>*.shtml<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">servlet-mapping</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- //End SpringMVC --&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">welcome-file-list</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">welcome-file</span>&gt;</span>index.html<span class="hljs-tag">&lt;/<span class="hljs-title">welcome-file</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">welcome-file</span>&gt;</span>index.jsp<span class="hljs-tag">&lt;/<span class="hljs-title">welcome-file</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">welcome-file-list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">web-app</span>&gt;</span>
</code></pre> 
  <h5 id="164040103">5.2.1.3 加入SpringSecurity配置</h5> 
  <p>目前为止上面所有的配置只是单纯配置了一个SpringMVC，并没有将SpringSecurity整合进去，那如何整合SpringSecurity呢？首先需要配置一个过滤器，紧接着要配置SpringSecurity相关拦截规则和授权规则即可，我们来配置一次。</p> 
  <ul> 
   <li> <p>web.xml中加入SpringSecurity过滤器</p> <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
</code><code class=" hljs xml"> <span class="hljs-comment">&lt;!--springsecurity过滤器，做资源权限的拦截和验证--&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>springSecurityFilterChain<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>springSecurityFilterChain<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span>
</code></pre> </li> 
   <li> <p>spring-security.xml配置文件</p> <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
</code><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">beans:beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.springframework.org/schema/security"</span>
             <span class="hljs-attribute">xmlns:beans</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
             <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/security
      http://www.springframework.org/schema/security/spring-security-4.2.xsd "</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">beans:beans</span>&gt;</span>
</code></pre> <p>此时不要忘了在springmvc.xml中引入spring-security.xml</p> <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--引入spring-security.xml--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">import</span> <span class="hljs-attribute">resource</span>=<span class="hljs-value">"spring-security.xml"</span> /&gt;</span>
</code></pre> </li> 
  </ul> 
  <h4 id="1160202">5.2.2 Spring Security入门学习</h4> 
  <h5 id="164040201">5.2.2.1 案例介绍</h5> 
  <p>一般后台管理系统，只有管理员登录之后才有权使用相关功能。例如用户管理，只有管理员登录后而且拥有用户管理的权限，才能对系统中的用户进行增删改查功能。用SpringSecurity如何实现呢？我们做这个案例。</p> 
  <h6 id="35608040101">5.2.2.1.1 创建UserController</h6> 
  <p>创建用户管理的Controller，并加入用户列表功能</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</code><code class=" hljs java"><span class="hljs-keyword">package</span> cn.itcast.controller;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-annotation">@Controller</span>
<span class="hljs-annotation">@RequestMapping</span>(value = <span class="hljs-string">"/admin/user"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>{

    <span class="hljs-javadoc">/***
     * 用户管理
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-annotation">@RequestMapping</span>(value = <span class="hljs-string">"/list"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">list</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"user_list"</span>;
    }
}
</code></pre> 
  <h6 id="35608040102">5.2.2.1.2 在/WEB-INF/view/下创建user_list.jsp</h6> 
  <p>为了演示效果，我们这里整点假数据展示</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</code><code class=" hljs xml"><span class="vbscript">&lt;%@ page contentType=<span class="hljs-string">"text/html;charset=UTF-8"</span> language=<span class="hljs-string">"java"</span> %&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>欢迎来到SpringSecurity的世界<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
    欢迎来到SpringSecurity的世界!<span class="hljs-tag">&lt;<span class="hljs-title">br</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>用户ID<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>张三2<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>张三3<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>张三4<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre> 
  <h6 id="35608040103">5.2.2.1.3 实现对/admin开始的请求拦截</h6> 
  <p>在spring-security.xml中配置拦截信息和授权认证管理器</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
</code><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">http</span> <span class="hljs-attribute">auto-config</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">use-expressions</span>=<span class="hljs-value">"true"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--所有带有admin的请求都需要ROLE_ADMIN权限--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">intercept-url</span> <span class="hljs-attribute">pattern</span>=<span class="hljs-value">"/admin/**"</span> <span class="hljs-attribute">access</span>=<span class="hljs-value">"hasRole('ROLE_ADMIN')"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">http</span>&gt;</span>

<span class="hljs-comment">&lt;!--授权认证管理器--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">authentication-manager</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">authentication-manager</span>&gt;</span>
</code></pre> 
  <p>http结点主要配置要拦截的url相关权限规则和处理方案。 <br><br>auto-config =true:默认会配置多个SpringSecurity相关过滤器，如果不配，就不能正常使用SpringSecurity相关功能。<br><br>use-expressions:是否使用SpELl表达式。<br><br>
   <intercept-url pattern="/**" access="hasRole('ROLE_ADMIN')">，pattern表示要拦截的路径，可以用通配符表示, * * 表示所有路径。 access表示对应地址访问所需的权限，如果use-expressions=“false”access=“hasRole(‘ROLE_ADMIN’)”这里的hasRole就可以去掉，我们后面都会设置成false，直接去掉这里的hasRole方便一点。ROLE_ADMIN表示ADMIN角色，这列角色自定义，可以随意定义什么角色，不过注意，这里必须得大写。<br></intercept-url></p> 
  <h6 id="35608040104">5.2.2.1.4 发布测试</h6> 
  <p>用tomcat发布测试，端口号根据你本机情况开放，我这里端口是18081<br>访问 localhost:18081/admin/user/list.shtml的时候跳转到了一个登陆界面，说明拦截配置生效了。</p> 
  <p><img src="https://i.imgur.com/uSwtU1m.png"></p> 
  <h6 id="35608040105">5.2.2.1.5 添加授权用户</h6> 
  <p>接着我们为上面登陆那里添加授权用于，允许他们登陆。修改spring-security.xml，在authentication-manager结点下加入如下代码：</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
</code><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">authentication-provider</span>&gt;</span>
    <span class="hljs-comment">&lt;!--硬编码方式提供账号密码--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">user-service</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">user</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"admin"</span> <span class="hljs-attribute">authorities</span>=<span class="hljs-value">"ROLE_ADMIN"</span> <span class="hljs-attribute">password</span>=<span class="hljs-value">"123456"</span> <span class="hljs-attribute">disabled</span>=<span class="hljs-value">"false"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">user-service</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">authentication-provider</span>&gt;</span>
</code></pre> 
  <p>这里提供了用户名为admin 密码123456 角色为ROLE_ADMIN的用户，这里的角色必须和上面http里配置的角色保持一致，否则仍然五权限访问。disabled=false表示不禁用也就是启用。这时候我们就可以通过该账号登录访问了。</p> 
  <p>登录后我们就可以访问http://localhost:18081/admin/user/list.shtml了</p> 
  <p><img src="https://i.imgur.com/ZxBfpSr.png"></p> 
  <h5 id="164040202">5.2.2.2 Spring Security常用配置</h5> 
  <p>基于上面的案例我们继续学习SpringSecurity相关知识。</p> 
  <h6 id="35608040201">5.2.2.2.1 取消安全校验</h6> 
  <p>我们网站中常常会有一些静态资源或者不需要校验权限的地址，例如注册和登录，我们在webapp下创建一个images文件夹，在里面放一张图片1.png。像这些地址或者静态资源我们如何取消权限校验呢？在spring-security.xml中加入如下代码：</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--不需要过滤的静态资源和开放连接--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">http</span> <span class="hljs-attribute">pattern</span>=<span class="hljs-value">"/images/**"</span> <span class="hljs-attribute">security</span>=<span class="hljs-value">"none"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">http</span> <span class="hljs-attribute">pattern</span>=<span class="hljs-value">"/login.shtml"</span> <span class="hljs-attribute">security</span>=<span class="hljs-value">"none"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">http</span> <span class="hljs-attribute">pattern</span>=<span class="hljs-value">"/login/fail.shtml"</span> <span class="hljs-attribute">security</span>=<span class="hljs-value">"none"</span> /&gt;</span>
</code></pre> 
  <p>这时候 <a href="http://localhost:18081/images/1.png">http://localhost:18081/images/1.png</a> 就可以访问了。<br>这时候 <a href="http://localhost:18081/images/1.png">http://localhost:18081/images/1.png</a> 就可以访问了。</p> 
  <h6 id="35608040202">5.2.2.2.2 自定义登录页面</h6> 
  <p>刚才那个登录页面不太美观，我们能不能让登录地址跳转到指定页面呢？<br><br>首先我们创建一个登录页面</p> 
  <p>/WEB-INF/view/login.jsp</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</code><code class=" hljs xml"><span class="vbscript">&lt;%@ page contentType=<span class="hljs-string">"text/html;charset=UTF-8"</span> language=<span class="hljs-string">"java"</span> %&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
欢迎登录！
<span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">'f'</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">'/login'</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">'POST'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>用户名:<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">'text'</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">'username'</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">''</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span>密码:<span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">'password'</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">'password'</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">td</span> <span class="hljs-attribute">colspan</span>=<span class="hljs-value">'2'</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Login"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre> 
  <p>LoginController<br>LoginController</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</code><code class=" hljs java"><span class="hljs-keyword">package</span> cn.itcast.controller;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-annotation">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>{

    <span class="hljs-javadoc">/***
     * 登录
     *<span class="hljs-javadoctag"> @return</span>
     */</span>
    <span class="hljs-annotation">@RequestMapping</span>(value = <span class="hljs-string">"/login"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span>  <span class="hljs-string">"login"</span>;
    }
}
</code></pre> 
  <p>修改spring-security.xml 在http结点中加入如下代码：<br>修改spring-security.xml 在http结点中加入如下代码：</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--自定义登录--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">form-login</span> <span class="hljs-attribute">login-page</span>=<span class="hljs-value">"/login.shtml"</span>
            <span class="hljs-attribute">default-target-url</span>=<span class="hljs-value">"/admin/user/list.shtml"</span>
            <span class="hljs-attribute">authentication-failure-url</span>=<span class="hljs-value">"/login/fail.shtml?error"</span>
            <span class="hljs-attribute">username-parameter</span>=<span class="hljs-value">"username"</span>
            <span class="hljs-attribute">password-parameter</span>=<span class="hljs-value">"password"</span>
            <span class="hljs-attribute">always-use-default-target</span>=<span class="hljs-value">"true"</span> /&gt;</span>
</code></pre> 
  <p>login-page:自定义登录页url,默认为/login <br><br>default-target-url:默认登录成功后跳转的url<br><br>authentication-failure-url: 登录失败后跳转的url<br><br>username-parameter:用户名的请求字段 默认为userName<br><br>password-parameter:密码的请求字段 默认为password<br><br>always-use-default-target:是否始终使用默认的地址，即登录成功后是否总是跳转到默认地址<br></p> 
  <p>再次登录，发现报403错误（如下），是因为SpringSecurity这里做了防csrf攻击校验，我们禁用csrf校验即可。</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
</code><code class=" hljs livecodeserver">HTTP Status <span class="hljs-number">403</span> – Forbidden
Type Status Report
Message Invalid CSRF Token <span class="hljs-string">'null'</span> was found <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">request</span> <span class="hljs-title">parameter</span> <span class="hljs-string">'_csrf'</span> <span class="hljs-title">or</span> <span class="hljs-title">header</span> <span class="hljs-string">'X-CSRF-TOKEN'</span>.</span>
Description The server understood <span class="hljs-operator">the</span> request but refuses <span class="hljs-built_in">to</span> authorize <span class="hljs-keyword">it</span>.
Apache Tomcat/<span class="hljs-number">8.5</span><span class="hljs-number">.16</span>
</code></pre> 
  <p>在http结点加入</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--禁用CSRF--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">csrf</span> <span class="hljs-attribute">disabled</span>=<span class="hljs-value">"true"</span> /&gt;</span>
</code></pre> 
  <h6 id="35608040203">5.2.2.2.3 登录错误信息处理</h6> 
  <p>在LoginController中加一个错误处理方法</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
</code><code class=" hljs cs"><span class="hljs-comment">/***
 * 登录失败
 * @return
 */</span>
@RequestMapping(<span class="hljs-keyword">value</span> = <span class="hljs-string">"/login/fail"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">loginfail</span><span class="hljs-params">(@RequestParam(<span class="hljs-keyword">value</span> = <span class="hljs-string">"error"</span>,required = <span class="hljs-keyword">false</span>)</span>String error, Model model)</span>{
    <span class="hljs-keyword">if</span>(error!=<span class="hljs-keyword">null</span>){
        model.addAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"账号或者密码不对！"</span>);
    }
    <span class="hljs-keyword">return</span>  <span class="hljs-string">"login"</span>;
}
</code></pre> 
  <p>在登录的jsp回显错误</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
</code><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">td</span> <span class="hljs-attribute">colspan</span>=<span class="hljs-value">'2'</span>&gt;</span>
        ${msg}<span class="hljs-tag">&lt;<span class="hljs-title">br</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Login"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">tr</span>&gt;</span>
</code></pre> 
  <h6 id="35608040204">5.2.2.2.4 数据库中的用户账号密码登录</h6> 
  <p>前面我们一直是写死的用户账号和密码，而真实环境中基本都是从数据库获取账号密码，这个如何实现？</p> 
  <p>首先创建一个数据库叫springsecurity，接着创建两张表，一张是users表，存放用户信息，另一张是authorities表，存放用户角色信息。</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</code><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`users`</span> (
  <span class="hljs-string">`username`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`password`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">60</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`enabled`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`username`</span>)
) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8;</span>

<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(username,<span class="hljs-keyword">password</span>,enabled)<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'itcast'</span>,<span class="hljs-string">'123456'</span>,<span class="hljs-string">'true'</span>);</span>



<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`authorities`</span> (
  <span class="hljs-string">`username`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-string">`authority`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`username`</span>)
) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8;</span>

<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> authorities(username,authority)<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'itcast'</span>,<span class="hljs-string">'ROLE_ADMIN'</span>);</span>
</code></pre> 
  <p>在spring-security.xml中配置数据源</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!-- 数据库连接池 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"dataSource"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.alibaba.druid.pool.DruidDataSource"</span>
      <span class="hljs-attribute">destroy-method</span>=<span class="hljs-value">"close"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"url"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"jdbc:mysql://127.0.0.1:3306/springsecurity?characterEncoding=utf8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"username"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"root"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"123456"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"driverClassName"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"com.mysql.jdbc.Driver"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maxActive"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"10"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"minIdle"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"5"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>
</code></pre> 
  <p>修改springsecurity.xml</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--授权认证管理器--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">authentication-manager</span>&gt;</span>
    <span class="hljs-comment">&lt;!--授权提供信息--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">authentication-provider</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">jdbc-user-service</span> <span class="hljs-attribute">data-source-ref</span>=<span class="hljs-value">"dataSource"</span> <span class="hljs-attribute">users-by-username-query</span>=<span class="hljs-value">"select username, password, enabled from users where username=?"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">authentication-provider</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">authentication-manager</span>&gt;</span>
</code></pre> 
  <p>这里需要根据用户名去数据库找对应的数据，如果找到了，springsecurity会根据查询的用户账号和密码与用登录输入的账号密码匹配，如果正确，则登录成功，否则失败。</p> 
  <h6 id="35608040205">5.2.2.2.5 加密密码匹配</h6> 
  <p>相对我们开发而言，数据库中的账号密码一般都是密文，刚才我们用的明文，name密文如何处理呢？</p> 
  <p>配置加密Bean</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
</code><code class=" hljs nix">&lt;beans:bean <span class="hljs-variable">id=</span><span class="hljs-string">"encoder"</span> <span class="hljs-variable">class=</span><span class="hljs-string">"org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"</span>&gt;
        &lt;beans:constructor-arg <span class="hljs-variable">name=</span><span class="hljs-string">"strength"</span> <span class="hljs-variable">value=</span><span class="hljs-string">"9"</span> /&gt;
&lt;/beans:bean&gt;
</code></pre> 
  <p>指定加密对象</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--授权认证管理器--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">authentication-manager</span>&gt;</span>
    <span class="hljs-comment">&lt;!--授权提供信息--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">authentication-provider</span>&gt;</span>
        <span class="hljs-comment">&lt;!--指定加密算法--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">password-encoder</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"encoder"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">jdbc-user-service</span> <span class="hljs-attribute">data-source-ref</span>=<span class="hljs-value">"dataSource"</span> <span class="hljs-attribute">users-by-username-query</span>=<span class="hljs-value">"select username, password, enabled from users where username=?"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">authentication-provider</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">authentication-manager</span>&gt;</span>
</code></pre> 
  <h6 id="35608040206">5.2.2.2.6 登出</h6> 
  <p>登出也就是注销、退出的意思。默认退出地址是/logout，然后跳转到了登录页，但有时候我们希望登出之后跳转到其他页面去，如何实现？</p> 
  <p>修改spring-security.xml，在http结点加入如下代码</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--退出--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">logout</span> <span class="hljs-attribute">logout-success-url</span>=<span class="hljs-value">"/logout.shtml"</span> /&gt;</span>
</code></pre> 
  <p>在LoginController加入如下方法</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
</code><code class=" hljs cs"><span class="hljs-comment">/***
 * 退出
 * @return
 */</span>
@RequestMapping(<span class="hljs-keyword">value</span> = <span class="hljs-string">"/logout"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">logout</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">return</span>  <span class="hljs-string">"redirect:/images/1.png"</span>;
}
</code></pre> 
  <p>这样用户退出后访问的将是1.png图片。</p> 
  <h6 id="35608040207">5.2.2.2.7 自定义用户登录校验规则</h6> 
  <p>有时候我们的校验规则并非这么简单，当我们需要自定义校验规则时，可以创建一个类，实现UserDetailsService接口来实现。</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</code><code class=" hljs java"><span class="hljs-keyword">package</span> cn.itcast.service;
<span class="hljs-keyword">import</span> org.springframework.security.core.GrantedAuthority;
<span class="hljs-keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.User;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDetailsServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDetailsService</span> </span>{

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDetails <span class="hljs-title">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException </span>{
        <span class="hljs-comment">//获取密文,这里可以从数据库获取</span>
        String password = <span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">"123456"</span>);

        <span class="hljs-comment">//用户授权，可以创建多个角色</span>
        List&lt;GrantedAuthority&gt; grantlist = <span class="hljs-keyword">new</span> ArrayList&lt;GrantedAuthority&gt;();
        grantlist.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(<span class="hljs-string">"ROLE_ADMIN"</span>));
        grantlist.add(<span class="hljs-keyword">new</span> SimpleGrantedAuthority(<span class="hljs-string">"ROLE_USER"</span>));

        <span class="hljs-comment">//第一个参数是用户名，方法直接传入了。</span>
        <span class="hljs-comment">//第二个参数是数据库查询出的密码，这里我们直接模拟了。</span>
        <span class="hljs-comment">//第三个参数是用户角色授权信息</span>
        User user = <span class="hljs-keyword">new</span> User(username, password, grantlist);
        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre> 
  <p>修改spring-security.xml</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--自定义校验类--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"cn.itcast.service.UserDetailsServiceImpl"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"userDetailsServiceImpl"</span> /&gt;</span>

<span class="hljs-comment">&lt;!--授权认证管理器--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">authentication-manager</span>&gt;</span>
    <span class="hljs-comment">&lt;!--授权提供信息--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">authentication-provider</span> <span class="hljs-attribute">user-service-ref</span>=<span class="hljs-value">"userDetailsServiceImpl"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--指定加密算法--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">password-encoder</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"encoder"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">authentication-provider</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">authentication-manager</span>&gt;</span>
</code></pre> 
  <h2 id="105">6. CAS</h2> 
  <h3 id="10501">6.1 CAS介绍</h3> 
  <blockquote> 
   <p>CAS是一个单点登录框架，由耶鲁大学的一个组织开发。CAS是一个开源项目，代码目前是在github上管理。</p> 
   <p>单点登录：Single Sign On,简称SSO，SSO使得在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。通俗理解为一个应用登录了，其他被授权的应用不用再登录。</p> 
   <p>下载地址：https://github.com/apereo/cas/releases或者https://casinitializr.herokuapp.com</p> 
  </blockquote> 
  <p><img src="https://i.imgur.com/El5o9cW.jpg"></p> 
  <h3 id="10502">6.2 CAS服务端搭建</h3> 
  <p>我们案例下载使用的是CAS4.2,采用HTTPS协议处理用户请求。搭建HTTPS需要咱们生成对应的证书信息。流程如下：</p> 
  <h4 id="1250201">6.2.1 HTTPS搭建</h4> 
  <h4 id="1250202">6.2.1.1 生成秘钥库</h4> 
  <p>我们这里采用JDK自带的工具生成秘钥库。为了方便记，我这里所有口令均输入123456. 其他信息均输入itcast.cn 。</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</code><code class=" hljs ruby">keytool -genkey -<span class="hljs-keyword">alias</span> itcast -keyalg <span class="hljs-constant">RSA</span> -keystore <span class="hljs-constant">D</span><span class="hljs-symbol">:/workspace/cas/keystory/itcast</span>
输入密钥库口令<span class="hljs-symbol">:</span><span class="hljs-number">123456</span>
再次输入新口令<span class="hljs-symbol">:</span><span class="hljs-number">123456</span>
您的名字与姓氏是什么?
  [<span class="hljs-constant">Unknown</span>]<span class="hljs-symbol">:</span>  itcast.cn
您的组织单位名称是什么?
  [<span class="hljs-constant">Unknown</span>]<span class="hljs-symbol">:</span>  itcast.cn
您的组织名称是什么?
  [<span class="hljs-constant">Unknown</span>]<span class="hljs-symbol">:</span>  itcast.cn
您所在的城市或区域名称是什么?
  [<span class="hljs-constant">Unknown</span>]<span class="hljs-symbol">:</span>  itcast.cn
您所在的省/市/自治区名称是什么?
  [<span class="hljs-constant">Unknown</span>]<span class="hljs-symbol">:</span>  gd
该单位的双字母国家/地区代码是什么?
  [<span class="hljs-constant">Unknown</span>]<span class="hljs-symbol">:</span>  zh
<span class="hljs-constant">CN</span>=itcast.cn, <span class="hljs-constant">OU</span>=itcast.cn, <span class="hljs-constant">O</span>=itcast.cn, <span class="hljs-constant">L</span>=itcast.cn, <span class="hljs-constant">ST</span>=gd, <span class="hljs-constant">C</span>=zh是否正确?
  [否]<span class="hljs-symbol">:</span>  y
<span class="hljs-prompt">输入 &lt;itcast&gt;</span> 的密钥口令<span class="hljs-number">123456</span>
        (如果和密钥库口令相同, 按回车)<span class="hljs-symbol">:</span>
再次输入新口令<span class="hljs-symbol">:</span><span class="hljs-number">123456</span>
</code></pre> 
  <p>导出证书<br>刚才把秘钥库生成了，紧接着依据秘钥库导出证书。</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
</code><code class=" hljs ruby"><span class="hljs-prompt">C:\Users\Administrator&gt;</span>keytool -export -trustcacerts -alias itcast -file <span class="hljs-constant">D</span><span class="hljs-symbol">:/workspace/cas/keystory/itcast</span>.cer -keystore <span class="hljs-constant">D</span><span class="hljs-symbol">:/workspace/cas/keystory/itcast</span>
输入密钥库口令<span class="hljs-symbol">:</span><span class="hljs-number">123456</span>
<span class="hljs-prompt">存储在文件 &lt;D:/workspace/cas/keystory/itcast.cer&gt;</span> 中的证书

<span class="hljs-prompt">C:\Users\Administrator&gt;</span>
</code></pre> 
  <p>将证书导入到JDK证书库</p> 
  <p>刚才的操作会根据我们的秘钥库生成一个证书，紧接着我们需要将该证书导入到JDK的证书库里才能使用。</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</code><code class=" hljs groovy"><span class="hljs-string">C:</span>\Users\Administrator&gt;keytool -<span class="hljs-keyword">import</span> -trustcacerts -alias itcast -file <span class="hljs-string">D:</span><span class="hljs-regexp">/workspace/</span>cas<span class="hljs-regexp">/keystory/</span>itcast.cer -keystore <span class="hljs-string">"C:/Program Files/Java/jdk1.8.0_91/jre/lib/security/cacerts"</span>
输入密钥库口令:
所有者: CN=itcast.cn, OU=itcast.cn, O=itcast.cn, L=sz, ST=gd, C=zh
发布者: CN=itcast.cn, OU=itcast.cn, O=itcast.cn, L=sz, ST=gd, C=zh
序列号: <span class="hljs-number">5714</span>b941
有效期开始日期: Wed Mar <span class="hljs-number">21</span> <span class="hljs-number">14</span>:<span class="hljs-number">44</span>:<span class="hljs-number">00</span> CST <span class="hljs-number">2018</span>, 截止日期: Tue Jun <span class="hljs-number">19</span> <span class="hljs-number">14</span>:<span class="hljs-number">44</span>:<span class="hljs-number">00</span> CST <span class="hljs-number">2018</span>
证书指纹:
<span class="hljs-label">         MD5:</span> <span class="hljs-number">33</span>:<span class="hljs-number">4</span><span class="hljs-string">E:</span><span class="hljs-number">86</span>:<span class="hljs-number">6</span><span class="hljs-string">A:</span><span class="hljs-number">91</span>:<span class="hljs-number">17</span>:<span class="hljs-number">4</span><span class="hljs-string">B:</span><span class="hljs-number">7</span><span class="hljs-string">E:</span><span class="hljs-number">82</span>:<span class="hljs-number">26</span>:<span class="hljs-number">8</span><span class="hljs-string">F:</span><span class="hljs-string">FD:</span><span class="hljs-number">09</span>:<span class="hljs-number">34</span>:<span class="hljs-string">EF:</span>CF
<span class="hljs-label">         SHA1:</span> <span class="hljs-string">CD:</span><span class="hljs-string">EE:</span><span class="hljs-number">46</span>:<span class="hljs-string">D3:</span><span class="hljs-string">E7:</span><span class="hljs-number">04</span>:<span class="hljs-string">E0:</span><span class="hljs-number">44</span>:<span class="hljs-number">23</span>:<span class="hljs-number">28</span>:<span class="hljs-string">BF:</span><span class="hljs-number">81</span>:<span class="hljs-number">84</span>:<span class="hljs-number">53</span>:<span class="hljs-number">57</span>:<span class="hljs-number">0</span><span class="hljs-string">C:</span><span class="hljs-string">DC:</span><span class="hljs-number">59</span>:<span class="hljs-string">D3:</span><span class="hljs-number">37</span>
<span class="hljs-label">         SHA256:</span> <span class="hljs-string">E7:</span><span class="hljs-string">A1:</span><span class="hljs-string">C6:</span><span class="hljs-number">66</span>:<span class="hljs-number">02</span>:<span class="hljs-string">A1:</span><span class="hljs-string">C5:</span><span class="hljs-number">0</span><span class="hljs-string">F:</span><span class="hljs-string">EA:</span><span class="hljs-number">23</span>:<span class="hljs-string">E5:</span><span class="hljs-string">C1:</span><span class="hljs-number">06</span>:<span class="hljs-number">55</span>:<span class="hljs-number">8</span><span class="hljs-string">E:</span><span class="hljs-number">00</span>:<span class="hljs-number">71</span>:<span class="hljs-number">6</span><span class="hljs-string">D:</span><span class="hljs-string">E9:</span><span class="hljs-string">E5:</span><span class="hljs-number">21</span>:<span class="hljs-number">73</span>:<span class="hljs-number">9</span><span class="hljs-string">B:</span><span class="hljs-string">C6:</span><span class="hljs-string">BE:</span><span class="hljs-string">C6:</span><span class="hljs-number">69</span>:<span class="hljs-number">71</span>:<span class="hljs-number">7</span><span class="hljs-string">A:</span><span class="hljs-string">B8:</span><span class="hljs-number">86</span>:<span class="hljs-number">3</span>B
         签名算法名称: SHA256withRSA
         版本: <span class="hljs-number">3</span>

扩展:

#<span class="hljs-number">1</span>: <span class="hljs-string">ObjectId:</span> <span class="hljs-number">2.5</span><span class="hljs-number">.29</span><span class="hljs-number">.14</span> Criticality=<span class="hljs-literal">false</span>
SubjectKeyIdentifier [
KeyIdentifier [
<span class="hljs-number">0000</span>: <span class="hljs-number">72</span> <span class="hljs-number">10</span> <span class="hljs-number">76</span> <span class="hljs-number">0</span>A <span class="hljs-number">97</span> <span class="hljs-number">97</span> <span class="hljs-number">5</span>F <span class="hljs-number">90</span>   <span class="hljs-number">64</span> D4 <span class="hljs-number">85</span> <span class="hljs-number">2</span>E <span class="hljs-number">81</span> <span class="hljs-number">0</span>E DF A7  r.v..._.d.......
<span class="hljs-number">0010</span>: <span class="hljs-number">8</span>C <span class="hljs-number">1</span>E EE <span class="hljs-number">83</span>                                        ....
]
]

是否信任此证书? [否]:  y
证书已添加到密钥库中
<span class="hljs-label">
C:</span>\Users\Administrator&gt;
</code></pre> 
  <h4 id="1250203">6.2.1.2 tomcat发布CAS服务端项目</h4> 
  <ol> 
   <li> <p>解压一个tomcat，放到D:\workspace\cas\目录下，把刚才我们下载的cas解压打开target目录下有个cas.war 拷贝到tomcat的webapps目录并解压，删除war包。</p></li> 
   <li> <p>下载的cas解压目录下还有一个文件target\war\work\org.jasig.cas\cas-server-webapp\WEB-INF\cas.properties，把他拷贝到webapps\cas\WEB-INF目录下。</p></li> 
   <li> <p>修改spring-configuration\propertyFileConfigurer.xml，把location=“file:/etc/cas/cas.properties”换成刚才cas.properties的绝对路径。</p> <p>&lt;util:properties id=“casProperties” location=“file:D:/workspace/cas/apache-tomcat-8.5.16/webapps/cas/WEB-INF/cas.properties” /&gt;</p> </li> 
  </ol> 
  <p>修改tomcat的conf/server.xml，加入如下代码</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
</code><code class=" hljs nix">&lt;Connector <span class="hljs-variable">port=</span><span class="hljs-string">"443"</span> <span class="hljs-variable">protocol=</span><span class="hljs-string">"org.apache.coyote.http11.Http11NioProtocol"</span>
       <span class="hljs-variable">maxThreads=</span><span class="hljs-string">"150"</span> <span class="hljs-variable">SSLEnabled=</span><span class="hljs-string">"true"</span> <span class="hljs-variable">scheme=</span><span class="hljs-string">"https"</span> <span class="hljs-variable">secure=</span><span class="hljs-string">"true"</span>
       <span class="hljs-variable">clientAuth=</span><span class="hljs-string">"false"</span> <span class="hljs-variable">sslProtocol=</span><span class="hljs-string">"TLS"</span>
       <span class="hljs-variable">keystoreFile=</span><span class="hljs-string">"D:\workspace\cas\keystory\itcast"</span> 
       <span class="hljs-variable">keystorePass=</span><span class="hljs-string">"123456"</span> /&gt;
</code></pre> 
  <p>启动tomcat</p> 
  <p>访问https://localhost 出现如下界面说明大功告成！</p> 
  <p><img src="https://i.imgur.com/tHw0LYk.png"></p> 
  <p>为了让https://itcast.cn 也能正常访问，我们把C:\Windows\System32\drivers\etc\hosts 打开，添加一行代码，让访问itcast.cn时访问本机。</p> 
  <pre><code class=" hljs vim"><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> itcast.<span class="hljs-keyword">cn</span>
</code></pre> 
  <p>我们访问https://itcast.cn/cas/login 此时是访问https不是http</p> 
  <p><img src="https://i.imgur.com/Deadive.png"></p> 
  <p>输入用户名：casuser&nbsp;&nbsp;&nbsp;密码：Mellon &nbsp;登录。</p> 
  <p><img src="https://i.imgur.com/eOGlTyK.png"></p> 
  <h4 id="1250204">6.2.1.3 配置数据库连接</h4> 
  <ol> 
   <li>打开webapps\cas\WEB-INF\deployerConfigContext.xml</li> 
   <li>把32行的<code>&lt;alias name="acceptUsersAuthenticationHandler" alias="primaryAuthenticationHandler" /&gt;</code> 注释掉。</li> 
   <li>将如下代码拷贝到deployerConfigContext.xml中 <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!--配置加密算法--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"MD5PasswordEncoder"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.jasig.cas.authentication.handler.DefaultPasswordEncoder"</span> <span class="hljs-attribute">autowire</span>=<span class="hljs-value">"byName"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">constructor-arg</span>  <span class="hljs-attribute">value</span>=<span class="hljs-value">"MD5"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

<span class="hljs-comment">&lt;!--查询数据所采用什么加密方式--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"queryDatabaseAuthenticationHandler"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"primaryAuthenticationHandler"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"passwordEncoder"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"MD5PasswordEncoder"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

<span class="hljs-comment">&lt;!--名字叫dataSource的Bean取别名叫queryDatabaseDataSource--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">alias</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"dataSource"</span> <span class="hljs-attribute">alias</span>=<span class="hljs-value">"queryDatabaseDataSource"</span>/&gt;</span>

<span class="hljs-comment">&lt;!--配置数据源--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"dataSource"</span>
       <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>
       <span class="hljs-attribute">p:driverClass</span>=<span class="hljs-value">"com.mysql.jdbc.Driver"</span>
       <span class="hljs-attribute">p:jdbcUrl</span>=<span class="hljs-value">"jdbc:mysql://127.0.0.1:3306/springsecurity?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;zeroDateTimeBehavior=convertToNull"</span>
       <span class="hljs-attribute">p:user</span>=<span class="hljs-value">"root"</span>
       <span class="hljs-attribute">p:password</span>=<span class="hljs-value">"123456"</span>
       <span class="hljs-attribute">p:initialPoolSize</span>=<span class="hljs-value">"6"</span>
       <span class="hljs-attribute">p:minPoolSize</span>=<span class="hljs-value">"6"</span>
       <span class="hljs-attribute">p:maxPoolSize</span>=<span class="hljs-value">"18"</span>
       <span class="hljs-attribute">p:maxIdleTimeExcessConnections</span>=<span class="hljs-value">"120"</span>
       <span class="hljs-attribute">p:checkoutTimeout</span>=<span class="hljs-value">"10000"</span>
       <span class="hljs-attribute">p:acquireIncrement</span>=<span class="hljs-value">"6"</span>
       <span class="hljs-attribute">p:acquireRetryAttempts</span>=<span class="hljs-value">"5"</span>
       <span class="hljs-attribute">p:acquireRetryDelay</span>=<span class="hljs-value">"2000"</span>
       <span class="hljs-attribute">p:idleConnectionTestPeriod</span>=<span class="hljs-value">"30"</span>
       <span class="hljs-attribute">p:preferredTestQuery</span>=<span class="hljs-value">"select 1"</span>/&gt;</span>
<span class="hljs-comment">&lt;!--end  从数据库中的用户表中读取 --&gt;</span>
</code></pre> </li> 
   <li> <p>把如下jar包拷贝到lib下</p></li> 
  </ol> 
  <p><img src="https://i.imgur.com/5NlyuNz.png"></p> 
  <p>5.配置查询语句</p> 
  <p>修改cas.properties 220行，去掉注释，修改如下：</p> 
  <pre><code class=" hljs sql">cas.jdbc.authn.query.sql=<span class="hljs-operator"><span class="hljs-keyword">select</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username=?
</span></code></pre> 
  <p>由于此时我们指定的加密算法为md5了，所以我们需要重新增加一条md5加密的数据到数据库去。<br>由于此时我们指定的加密算法为md5了，所以我们需要重新增加一条md5加密的数据到数据库去。</p> 
  <pre><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(username,<span class="hljs-keyword">password</span>,enabled)<span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'itheima'</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MD5</span>(<span class="hljs-string">'123456'</span>)),<span class="hljs-string">'true'</span>);</span>
</code></pre> 
  <p>重启tomcat，用itheima登录成功。</p> 
  <h4 id="1250205">6.2.2 CSA实现单点登录功能</h4> 
  <p>新建一个maven工程，配置一下CAS相关过滤器，然后访问首页。</p> 
  <p>pom依赖</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
</code><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.jasig.cas.client<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>cas-client-core<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.3.3<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
</code></pre> 
  <p>web.xml</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</code><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">web-app</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee"</span>
         <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span>
         <span class="hljs-attribute">version</span>=<span class="hljs-value">"3.1"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">listener</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">listener-class</span>&gt;</span>org.jasig.cas.client.session.SingleSignOutHttpSessionListener<span class="hljs-tag">&lt;/<span class="hljs-title">listener-class</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">listener</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 该过滤器用于实现单点登出功能，可选配置。 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS Single Sign Out Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>org.jasig.cas.client.session.SingleSignOutFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS Single Sign Out Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 该过滤器负责用户的认证工作，必须启用它 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CASFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>org.jasig.cas.client.authentication.AuthenticationFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>casServerLoginUrl<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>https://itcast.cn/cas/login<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
      <span class="hljs-comment">&lt;!--这里的server是服务端的IP --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>serverName<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>http://localhost:18082<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CASFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 该过滤器负责对Ticket的校验工作，必须启用它 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS Validation Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>casServerUrlPrefix<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>https://itcast.cn/cas<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>serverName<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>http://localhost:18082<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS Validation Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS HttpServletRequest Wrapper Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>
      org.jasig.cas.client.util.HttpServletRequestWrapperFilter
    <span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS HttpServletRequest Wrapper Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS Assertion Thread Local Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>org.jasig.cas.client.util.AssertionThreadLocalFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>CAS Assertion Thread Local Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">welcome-file-list</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">welcome-file</span>&gt;</span>index.jsp<span class="hljs-tag">&lt;/<span class="hljs-title">welcome-file</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">welcome-file-list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">web-app</span>&gt;</span>
</code></pre> 
  <p>tomcat运行，端口18082</p> 
  <p>访问报错</p> 
  <p><img src="https://i.imgur.com/LDwd4EQ.png"></p> 
  <p>上面错误的原因是因为CAS默认值接受HTTPS有IMAPS协议请求的认证，我们需要把HTTP也给加上去。</p> 
  <p>打开cas\WEB-INF\classes\services\HTTPSandIMAPS-10000001.json，修改第3行</p> 
  <pre><code class=" hljs bash"><span class="hljs-string">"serviceId"</span> : <span class="hljs-string">"^(https|imaps)://.*"</span>,
</code></pre> 
  <p>改成</p> 
  <pre><code class=" hljs bash"><span class="hljs-string">"serviceId"</span> : <span class="hljs-string">"^(https|imaps|http)://.*"</span>,
</code></pre> 
  <p>保存，并重新启动即可。</p> 
  <h4 id="1250206">6.2.3 拷贝casclient-demo1 进行单点测试</h4> 
  <p>拷贝casclien-demo1 改名casclient-demo2 部署，tomcat端口18083，进行单点测试。一个站点登录后另外一个站点就不需要登录了。</p> 
  <p>如果运营一旦出现如下错误，请调整tomcat的JDK，和生成秘钥的JDK保持一致，不要用SDK即可。</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</code><code class=" hljs groovy">java.lang.<span class="hljs-string">RuntimeException:</span> javax.net.ssl.<span class="hljs-string">SSLHandshakeException:</span> sun.security.validator.<span class="hljs-string">ValidatorException:</span> PKIX path building <span class="hljs-string">failed:</span> sun.security.provider.certpath.<span class="hljs-string">SunCertPathBuilderException:</span> unable to find valid certification path to requested target
org.jasig.cas.client.util.CommonUtils.getResponseFromServer(CommonUtils.<span class="hljs-string">java:</span><span class="hljs-number">407</span>)
org.jasig.cas.client.validation.AbstractCasProtocolUrlBasedTicketValidator.retrieveResponseFromServer(AbstractCasProtocolUrlBasedTicketValidator.<span class="hljs-string">java:</span><span class="hljs-number">45</span>)
org.jasig.cas.client.validation.AbstractUrlBasedTicketValidator.validate(AbstractUrlBasedTicketValidator.<span class="hljs-string">java:</span><span class="hljs-number">200</span>)
org.jasig.cas.client.validation.AbstractTicketValidationFilter.doFilter(AbstractTicketValidationFilter.<span class="hljs-string">java:</span><span class="hljs-number">206</span>)
org.jasig.cas.client.authentication.AuthenticationFilter.doFilter(AuthenticationFilter.<span class="hljs-string">java:</span><span class="hljs-number">161</span>)
org.jasig.cas.client.session.SingleSignOutFilter.doFilter(SingleSignOutFilter.<span class="hljs-string">java:</span><span class="hljs-number">100</span>)

Root Cause

javax.net.ssl.<span class="hljs-string">SSLHandshakeException:</span> sun.security.validator.<span class="hljs-string">ValidatorException:</span> PKIX path building <span class="hljs-string">failed:</span> sun.security.provider.certpath.<span class="hljs-string">SunCertPathBuilderException:</span> unable to find valid certification path to requested target
    sun.security.ssl.Alerts.getSSLException(Alerts.<span class="hljs-string">java:</span><span class="hljs-number">192</span>)
    sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1949</span>)
    sun.security.ssl.Handshaker.fatalSE(Handshaker.<span class="hljs-string">java:</span><span class="hljs-number">302</span>)
    sun.security.ssl.Handshaker.fatalSE(Handshaker.<span class="hljs-string">java:</span><span class="hljs-number">296</span>)
    sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.<span class="hljs-string">java:</span><span class="hljs-number">1509</span>)
    sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.<span class="hljs-string">java:</span><span class="hljs-number">216</span>)
    sun.security.ssl.Handshaker.processLoop(Handshaker.<span class="hljs-string">java:</span><span class="hljs-number">979</span>)
    sun.security.ssl.Handshaker.process_record(Handshaker.<span class="hljs-string">java:</span><span class="hljs-number">914</span>)
    sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1062</span>)
    sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1375</span>)
    sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1403</span>)
    sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1387</span>)
    sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.<span class="hljs-string">java:</span><span class="hljs-number">559</span>)
    sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.<span class="hljs-string">java:</span><span class="hljs-number">185</span>)
    sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.<span class="hljs-string">java:</span><span class="hljs-number">1513</span>)
    sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.<span class="hljs-string">java:</span><span class="hljs-number">1441</span>)
    sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.<span class="hljs-string">java:</span><span class="hljs-number">254</span>)
    org.jasig.cas.client.util.CommonUtils.getResponseFromServer(CommonUtils.<span class="hljs-string">java:</span><span class="hljs-number">393</span>)
    org.jasig.cas.client.validation.AbstractCasProtocolUrlBasedTicketValidator.retrieveResponseFromServer(AbstractCasProtocolUrlBasedTicketValidator.<span class="hljs-string">java:</span><span class="hljs-number">45</span>)
    org.jasig.cas.client.validation.AbstractUrlBasedTicketValidator.validate(AbstractUrlBasedTicketValidator.<span class="hljs-string">java:</span><span class="hljs-number">200</span>)
    org.jasig.cas.client.validation.AbstractTicketValidationFilter.doFilter(AbstractTicketValidationFilter.<span class="hljs-string">java:</span><span class="hljs-number">206</span>)
    org.jasig.cas.client.authentication.AuthenticationFilter.doFilter(AuthenticationFilter.<span class="hljs-string">java:</span><span class="hljs-number">161</span>)
    org.jasig.cas.client.session.SingleSignOutFilter.doFilter(SingleSignOutFilter.<span class="hljs-string">java:</span><span class="hljs-number">100</span>)

Root Cause

sun.security.validator.<span class="hljs-string">ValidatorException:</span> PKIX path building <span class="hljs-string">failed:</span> sun.security.provider.certpath.<span class="hljs-string">SunCertPathBuilderException:</span> unable to find valid certification path to requested target
    sun.security.validator.PKIXValidator.doBuild(PKIXValidator.<span class="hljs-string">java:</span><span class="hljs-number">387</span>)
    sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.<span class="hljs-string">java:</span><span class="hljs-number">292</span>)
    sun.security.validator.Validator.validate(Validator.<span class="hljs-string">java:</span><span class="hljs-number">260</span>)
    sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.<span class="hljs-string">java:</span><span class="hljs-number">324</span>)
    sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.<span class="hljs-string">java:</span><span class="hljs-number">229</span>)
    sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.<span class="hljs-string">java:</span><span class="hljs-number">124</span>)
    sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.<span class="hljs-string">java:</span><span class="hljs-number">1491</span>)
    sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.<span class="hljs-string">java:</span><span class="hljs-number">216</span>)
    sun.security.ssl.Handshaker.processLoop(Handshaker.<span class="hljs-string">java:</span><span class="hljs-number">979</span>)
    sun.security.ssl.Handshaker.process_record(Handshaker.<span class="hljs-string">java:</span><span class="hljs-number">914</span>)
    sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1062</span>)
    sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1375</span>)
    sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1403</span>)
    sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.<span class="hljs-string">java:</span><span class="hljs-number">1387</span>)
    sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.<span class="hljs-string">java:</span><span class="hljs-number">559</span>)
    sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.<span class="hljs-string">java:</span><span class="hljs-number">185</span>)
    sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.<span class="hljs-string">java:</span><span class="hljs-number">1513</span>)
    sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.<span class="hljs-string">java:</span><span class="hljs-number">1441</span>)
    sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.<span class="hljs-string">java:</span><span class="hljs-number">254</span>)
    org.jasig.cas.client.util.CommonUtils.getResponseFromServer(CommonUtils.<span class="hljs-string">java:</span><span class="hljs-number">393</span>)
    org.jasig.cas.client.validation.AbstractCasProtocolUrlBasedTicketValidator.retrieveResponseFromServer(AbstractCasProtocolUrlBasedTicketValidator.<span class="hljs-string">java:</span><span class="hljs-number">45</span>)
    org.jasig.cas.client.validation.AbstractUrlBasedTicketValidator.validate(AbstractUrlBasedTicketValidator.<span class="hljs-string">java:</span><span class="hljs-number">200</span>)
    org.jasig.cas.client.validation.AbstractTicketValidationFilter.doFilter(AbstractTicketValidationFilter.<span class="hljs-string">java:</span><span class="hljs-number">206</span>)
    org.jasig.cas.client.authentication.AuthenticationFilter.doFilter(AuthenticationFilter.<span class="hljs-string">java:</span><span class="hljs-number">161</span>)
    org.jasig.cas.client.session.SingleSignOutFilter.doFilter(SingleSignOutFilter.<span class="hljs-string">java:</span><span class="hljs-number">100</span>)
</code></pre> 
  <h4 id="1250207">6.2.4 获取登录名</h4> 
  <p>&lt;%=request.getRemoteUser()%&gt;即可获取登录名。</p> 
  <p><img src="https://i.imgur.com/bhUUziD.png"></p> 
  <h2 id="106"><a href="#7-spring-security集成cas" name="7-spring-security集成cas">7 Spring Security集成CAS</a></h2> 
  <p>把刚才的springsecurity-demo复制一份改名springsecurity-cas</p> 
  <p>pom.xml加入servlet依赖</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</code><code class=" hljs xml"><span class="hljs-comment">&lt;!-- JSP相关 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>servlet-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.5<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>jsp-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
</code></pre> 
  <p>修改spring-security.xml</p> 
  <pre><code class="hljs hljs-line-numbers" style="float: left;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</code><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">beans:beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.springframework.org/schema/security"</span>
             <span class="hljs-attribute">xmlns:beans</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
             <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/security
      http://www.springframework.org/schema/security/spring-security-4.2.xsd "</span>&gt;</span>

    <span class="hljs-comment">&lt;!--不需要过滤的静态资源和开放连接--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">http</span> <span class="hljs-attribute">pattern</span>=<span class="hljs-value">"/images/**"</span> <span class="hljs-attribute">security</span>=<span class="hljs-value">"none"</span> /&gt;</span>

    <span class="hljs-comment">&lt;!--   entry-point-ref  入口点引用 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">http</span> <span class="hljs-attribute">use-expressions</span>=<span class="hljs-value">"false"</span> <span class="hljs-attribute">entry-point-ref</span>=<span class="hljs-value">"casProcessingFilterEntryPoint"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">intercept-url</span> <span class="hljs-attribute">pattern</span>=<span class="hljs-value">"/**"</span> <span class="hljs-attribute">access</span>=<span class="hljs-value">"ROLE_ADMIN"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">csrf</span> <span class="hljs-attribute">disabled</span>=<span class="hljs-value">"true"</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- custom-filter为过滤器， position 表示将过滤器放在指定的位置上，before表示放在指定位置之前  ，after表示放在指定的位置之后  --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">custom-filter</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"casAuthenticationFilter"</span>  <span class="hljs-attribute">position</span>=<span class="hljs-value">"CAS_FILTER"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">custom-filter</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"requestSingleLogoutFilter"</span> <span class="hljs-attribute">before</span>=<span class="hljs-value">"LOGOUT_FILTER"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">custom-filter</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"singleLogoutFilter"</span> <span class="hljs-attribute">before</span>=<span class="hljs-value">"CAS_FILTER"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">http</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- CAS入口点 开始 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"casProcessingFilterEntryPoint"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.security.cas.web.CasAuthenticationEntryPoint"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 单点登录服务器登录URL --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"loginUrl"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"https://itcast.cn/cas/login"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"serviceProperties"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"serviceProperties"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"serviceProperties"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.security.cas.ServiceProperties"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--service 配置自身工程的根地址+/login/cas   --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"service"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"http://localhost:18084/login/cas"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- CAS入口点 结束 --&gt;</span>


    <span class="hljs-comment">&lt;!-- 认证过滤器 开始 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"casAuthenticationFilter"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.security.cas.web.CasAuthenticationFilter"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"authenticationManager"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"authenticationManager"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 认证管理器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">authentication-manager</span> <span class="hljs-attribute">alias</span>=<span class="hljs-value">"authenticationManager"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">authentication-provider</span>  <span class="hljs-attribute">ref</span>=<span class="hljs-value">"casAuthenticationProvider"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">authentication-provider</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">authentication-manager</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 认证提供者 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"casAuthenticationProvider"</span>     <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.security.cas.authentication.CasAuthenticationProvider"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"authenticationUserDetailsService"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">beans:constructor-arg</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"userDetailsService"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">beans:property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"serviceProperties"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"serviceProperties"</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- ticketValidator 为票据验证器 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ticketValidator"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.jasig.cas.client.validation.Cas20ServiceTicketValidator"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">beans:constructor-arg</span> <span class="hljs-attribute">index</span>=<span class="hljs-value">"0"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"https://itcast.cn/cas"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">beans:property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"key"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"an_id_for_this_auth_provider_only"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 认证类 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"userDetailsService"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"cn.itcast.service.UserDetailsServiceImpl"</span>/&gt;</span>
    <span class="hljs-comment">&lt;!-- 认证过滤器 结束 --&gt;</span>


    <span class="hljs-comment">&lt;!-- 单点登出  开始  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"singleLogoutFilter"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.jasig.cas.client.session.SingleSignOutFilter"</span>/&gt;</span>
    <span class="hljs-comment">&lt;!-- 经过此配置，当用户在地址栏输入本地工程 /logout/cas  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"requestSingleLogoutFilter"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.security.web.authentication.logout.LogoutFilter"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:constructor-arg</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"https://itcast.cn/cas/logout?service=http://localhost:18084/images/1.png"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:constructor-arg</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">beans:bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">beans:constructor-arg</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">beans:property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"filterProcessesUrl"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"/logout/cas"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">beans:bean</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 单点登出  结束 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">beans:beans</span>&gt;</span>
</code></pre> 
  <p>获取登录名字</p> 
  <pre><code class=" hljs ">SecurityContextHolder.getContext().getAuthentication().getName()
</code></pre>
 

      </article>
  </div>